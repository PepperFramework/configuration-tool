@page "/manage-questions"
@inject IStringLocalizer<ApplicationResource> _localizer

<PageTitle>@_localizer["QuestionsManagement"]</PageTitle>

<MudText Typo="Typo.h3" GutterBottom="true">@_localizer["QuestionsManagement"]</MudText>

<MudGrid>
    <MudItem xs="12" sm="7">
        <MudPaper Class="pa-4">
            <MudForm @ref="form" @bind-IsValid="@success">
                <MudTextField T="string" Label="Frage" Required="true" @ref="questionInput"
                              RequiredError="Bitte geben Sie einen Frage mit mindestens 10 Buchstaben ein"
                              Validation="@(new Func<string, IEnumerable<string>>(LengthCheck))"/>

                @foreach (var answer in answers)
                {
                    <MudGrid>
                        <MudItem xs="10" sm="10">
                            <MudTextField T="string" Label="Antwort" Required="true" @ref="answerInput"
                                          RequiredError="Bitte geben Sie eine Antwort mit mindestens 10 Buchstaben ein"
                                          Validation="@(new Func<string, IEnumerable<string>>(LengthCheck))"/>
                        </MudItem>
                        @if (answers.Count > 1)
                        {
                            <MudItem xs="2" sm="2">
                                <MudIconButton Style="width: auto; margin-left: 10px;" Icon="@Icons.Material.Filled.Close" Color="Color.Secondary" OnClick="@(() => RemoveAnswer(answer))"/>
                            </MudItem>
                        }
                        else
                        {
                            <MudItem xs="2" sm="2">
                                <MudIconButton Disabled="true" Style="width: auto; margin-left: 10px;" Icon="@Icons.Material.Filled.Close" Color="Color.Secondary" OnClick="@(() => RemoveAnswer(answer))"/>
                            </MudItem>
                        }
                    </MudGrid>
                }
            </MudForm>
        </MudPaper>
    </MudItem>
    <MudItem xs="12" sm="5">
        <MudPaper Class="pa-4 mt-4">
            <MudButton Style="width: 100%; margin-bottom: 10px;" Variant="Variant.Filled" Color="Color.Primary" OnClick="AddAnswer">
                <MudIcon Icon="@Icons.Material.Filled.Add" Title="Add"/>
                Add answer option
            </MudButton>
            <MudButton Style="width: 100%;" Variant="Variant.Filled" Color="Color.Secondary" OnClick="SubmitQuestion">
                <MudIcon Icon="@Icons.Material.Filled.Send" Title="Submit"/>
                Submit question
            </MudButton>
        </MudPaper>
    </MudItem>
</MudGrid>

@code {
    bool success;
    MudTextField<string> questionInput;
    MudTextField<string> answerInput;
    MudForm form;
    List<string> answers = new() { string.Empty };

    private IEnumerable<string> LengthCheck(string input)
    {
        if (string.IsNullOrWhiteSpace(input))
        {
            yield return "Ein Input wird benötigt";
            yield break;
        }
        if (input.Length < 10)
            yield return "Bitte geben Sie mindestens 10 Buchstaben ein";
    }

    private void AddAnswer()
    {
        answers.Add(string.Empty);
    }

    private void SubmitQuestion()
    {
    }

    private void RemoveAnswer(string answer)
    {
        answers.Remove(answer);
    }

}